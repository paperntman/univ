(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}})();const te="/api",Ze="#cccccc",vt="학과와 성적을 입력하고 필터를 적용하여 상세 정보를 확인하세요.",Ce=[{subjectCode:"SA01",subjectName:"생활과 윤리"},{subjectCode:"SA02",subjectName:"윤리와 사상"},{subjectCode:"SA03",subjectName:"한국지리"},{subjectCode:"SA04",subjectName:"세계지리"},{subjectCode:"SA05",subjectName:"동아시아사"},{subjectCode:"SA06",subjectName:"세계사"},{subjectCode:"SA07",subjectName:"경제"},{subjectCode:"SA08",subjectName:"정치와 법"},{subjectCode:"SA09",subjectName:"사회·문화"},{subjectCode:"SC01",subjectName:"물리학Ⅰ"},{subjectCode:"SC02",subjectName:"화학Ⅰ"},{subjectCode:"SC03",subjectName:"생명과학Ⅰ"},{subjectCode:"SC04",subjectName:"지구과학Ⅰ"},{subjectCode:"SC05",subjectName:"물리학Ⅱ"},{subjectCode:"SC06",subjectName:"화학Ⅱ"},{subjectCode:"SC07",subjectName:"생명과학Ⅱ"},{subjectCode:"SC08",subjectName:"지구과학Ⅱ"}],Xe=[{subjectCode:"KOR_OPT_HWAPJAK",subjectName:"화법과 작문"},{subjectCode:"KOR_OPT_EONMAE",subjectName:"언어와 매체"}],Qe=[{subjectCode:"MAT_OPT_HWAKTONG",subjectName:"확률과 통계"},{subjectCode:"MAT_OPT_MIJEOK",subjectName:"미적분"},{subjectCode:"MAT_OPT_GIHA",subjectName:"기하"}];let A=null;function yt(e){A=e}let B=null;function St(e){B=e}let T=[];function ae(e){T=e}let ge=null;function we(e){ge=e}let z=10;function $e(e){z=e}let ne="경쟁률";function Et(e){ne=e}let w=null;function le(e){w=e}let k=-1;function fe(e){k=e}let W=null;function et(e){W=e}function De(){return{subjects:[]}}function ve(){return{semester1:De(),semester2:De()}}function jt(){return{year1:ve(),year2:ve(),year3:ve()}}function Ct(){var a,s;const e=((a=Xe[0])==null?void 0:a.subjectName)||"",t=((s=Qe[0])==null?void 0:s.subjectName)||"",r=Ce[0],n=Ce[1];return{examYear:2024,examMonth:11,examIdentifierForCutInfo:"202411_csat",subjects:{korean:{selectedOption:e,rawScore:null,standardScore:null,percentile:null,grade:null},math:{selectedOption:t,rawScore:null,standardScore:null,percentile:null,grade:null},english:{rawScore:null,standardScore:null,percentile:null,grade:null},history:{rawScore:null,standardScore:null,percentile:null,grade:null},explorer1:{subjectCode:r==null?void 0:r.subjectCode,subjectName:r==null?void 0:r.subjectName,rawScore:null,standardScore:null,percentile:null,grade:null},explorer2:{subjectCode:n==null?void 0:n.subjectCode,subjectName:n==null?void 0:n.subjectName,rawScore:null,standardScore:null,percentile:null,grade:null}}}}function tt(){return{naesin:jt(),suneung:Ct()}}let h=tt();function wt(e){h=e}function It(e){h.suneung=e}let nt=[];function xt(e){nt=e}let rt=Xe;function Nt(e){rt=e}let at=Qe;function Mt(e){at=e}let Ie=Ce;function At(e){Ie=e}let ie=null;function se(e){ie=e}let xe=null,b=null,v=null;function Lt(e){xe=e.loadingOverlay,b=e.departmentSearchInput,v=e.departmentSuggestionsDiv,b&&(b.addEventListener("input",kt),b.addEventListener("keydown",Tt)),document.addEventListener("click",t=>{if(!b||!v)return;b.contains(t.target)||v.contains(t.target)||J()})}function $t(e,t){let r=null;return(...n)=>new Promise(a=>{r&&clearTimeout(r),r=setTimeout(()=>a(e(...n)),t)})}function C(e){xe&&(xe.style.display=e?"flex":"none",document.body.setAttribute("aria-busy",e.toString()))}async function Dt(e){if(!b||!v)return;const t=typeof e=="string"?e:e.target.value;if(t.length<1){ye([]);return}C(!0);try{const r=await Bt(t);ye(r)}catch(r){console.error("Error fetching department suggestions:",r),ye([]),alert("학과 추천 목록을 가져오는 중 오류가 발생했습니다.")}finally{C(!1)}}const kt=$t(Dt,250);function ye(e){!v||!b||(v.innerHTML="",fe(-1),e.length>0?(e.forEach((t,r)=>{const n=document.createElement("div");n.textContent=t.departmentName,n.setAttribute("role","option"),n.setAttribute("id",`suggestion-${r}`),n.tabIndex=-1,n.addEventListener("click",()=>{b.value=t.departmentName,we(t.departmentName),J()}),v.appendChild(n)}),v.style.display="block"):v.style.display="none")}function J(){v&&(v.innerHTML="",v.style.display="none"),fe(-1)}function Tt(e){if(!v||!b)return;const t=v.querySelectorAll('div[role="option"]');if(!(t.length===0&&e.key!=="Escape"))switch(e.key){case"ArrowDown":e.preventDefault(),fe(Math.min(k+1,t.length-1)),ke(t);break;case"ArrowUp":e.preventDefault(),fe(Math.max(k-1,0)),ke(t);break;case"Enter":e.preventDefault(),k>-1&&k<t.length?t[k].click():(t.length>0&&b.value.trim()!==""||b.value.trim()!=="")&&(we(b.value.trim()),J());break;case"Escape":J();break;default:return}}function ke(e){b&&e.forEach((t,r)=>{const n=r===k;t.classList.toggle("selected",n),t.setAttribute("aria-selected",n.toString()),n&&t.focus()})}async function P(e,t){if(!e.ok){const r=await e.text();return console.error(`${t}: ${e.status} ${e.statusText}`,r),alert(`${t} (오류: ${e.status})`),null}try{return await e.json()}catch(r){return console.error(`JSON 파싱 오류: ${t}`,r),alert("서버 응답 처리 중 오류가 발생했습니다. (JSON 파싱 실패)"),null}}async function Ft(){C(!0);try{const e=await fetch("/map/initial-data");return await P(e,"초기 대학 마커 데이터를 불러오는 데 실패했습니다.")||[]}catch(e){return console.error("Error fetching initial map data:",e),alert("초기 대학 마커 데이터를 불러오는 중 네트워크 오류가 발생했습니다."),[]}finally{C(!1)}}async function Bt(e){try{const t=await fetch(`${te}/departments/suggest?query=${encodeURIComponent(e)}`);return await P(t,"학과 추천 목록을 가져오는 데 실패했습니다.")||[]}catch(t){return console.error("Error fetching department suggestions:",t),[]}}async function oe(e){try{const t=await fetch(`${te}/subjects?type=${e}`);return await P(t,`${e} 과목 목록을 가져오는 데 실패했습니다.`)||[]}catch(t){return console.error(`Error fetching ${e} subjects:`,t),[]}}async function Ot(){C(!0);try{const[e,t,r,n]=await Promise.all([oe("naesin"),oe("suneung_국어"),oe("suneung_수학"),oe("suneung_탐구")]);xt(e),Nt(t),Mt(r),At(n)}catch(e){console.error("Error fetching all subject lists:",e),alert("전체 과목 목록을 가져오는 중 오류가 발생했습니다.")}finally{C(!1)}}async function Rt(e,t){try{const r=await fetch(`${te}/exam-grade-cuts?year=${e}&month=${t}`);return await P(r,"수능 등급컷 정보를 가져오는 데 실패했습니다.")}catch(r){return console.error("Error fetching Suneung exam cut info (API call):",r),alert("수능 등급컷 정보 조회 중 네트워크 오류가 발생했습니다."),null}}async function Ne(e){if(!e){se(null);return}const[t]=e.split("_"),r=t.substring(0,4),n=t.substring(4,6);if(!r||!n){console.error("Invalid examId format for fetching cut info:",e),se(null),alert("잘못된 시험 식별자입니다.");return}C(!0);try{const a=await Rt(r,n);se(a)}catch{se(null)}finally{C(!1)}}async function Gt(e){C(!0);try{const t=await fetch(`${te}/universities/filter`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await P(t,"대학 정보 필터링에 실패했습니다.")||[]}catch(t){return console.error("Error fetching filtered universities:",t),alert("대학 정보 필터링 중 네트워크 오류가 발생했습니다."),[]}finally{C(!1)}}async function Kt(e,t,r){C(!0);try{const n=`${te}/universities/${e}/sidebar-details?departmentName=${encodeURIComponent(t)}&admissionTypeFilter=${encodeURIComponent(r)}`,a=await fetch(n);return await P(a,"대학 상세 정보를 불러오는 데 실패했습니다.")}catch(n){return console.error("Exception fetching sidebar details:",n),alert("대학 상세 정보 조회 중 네트워크 오류가 발생했습니다."),null}finally{C(!1)}}let I=null,ue=null,Se=null;function _t(e,t,r){I=e,ue=t,Se=r,Se&&Se.addEventListener("click",ot)}async function st(e,t){if(I){et(e);try{const r=await Kt(e,t,ne);r?(le(r),ce(),I.classList.remove("hidden"),I.classList.add("visible"),I.setAttribute("aria-hidden","false")):(le(null),ce())}catch(r){console.error("Exception in openSidebar after API call:",r),le(null),ce()}finally{}}}function ot(){I&&(I.classList.remove("visible"),I.classList.add("hidden"),I.setAttribute("aria-hidden","true"),le(null),et(null))}function ce(){if(!ue)return;if(!w){ue.innerHTML="<p>표시할 정보가 없습니다.</p>";return}let e=`
        <h3 id="sidebar-title">${w.universityName} - ${w.departmentName}</h3>
        ${w.logoUrl?`<img src="${w.logoUrl}" alt="${w.universityName} 로고" style="max-width:100px; margin: 0 auto 15px; display: block;">`:""}
    `;[...w.sidebarSections].sort((r,n)=>r.isHighlighted&&!n.isHighlighted?-1:!r.isHighlighted&&n.isHighlighted?1:0).forEach(r=>{const n=`section-title-${r.sectionTitle.replace(/\s+/g,"-").toLowerCase()}`;e+=`<div class="sidebar-section ${r.isHighlighted?"highlighted":""}" role="region" aria-labelledby="${n}">
                    <h4 id="${n}">${r.sectionTitle}</h4>`,r.items.forEach(a=>{let s=String(a.value);const i=a.link||(a.type==="link"?String(a.value):void 0);if(i){const o=a.type==="link"&&(a.label==="대학 입학처"||a.label==="학과 홈페이지")?"바로가기":a.value;s=`<a href="${i}" target="_blank" rel="noopener noreferrer">${o} <span class="external-link-indicator" aria-label="(새 창 열림)">↗</span></a>`}e+=`<div class="item">
                        <span class="label">${a.label}:</span>
                        <span class="value">${s}</span>
                    </div>`}),r.notes&&r.notes.length>0&&(e+='<ul class="notes">',r.notes.forEach(a=>{e+=`<li>${a}</li>`}),e+="</ul>"),e+="</div>"}),ue.innerHTML=e}function Ut(e){if(e&&!A){const t=L.map(e).setView([36.5,127.5],7);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(t);const r=L.layerGroup().addTo(t);St(r),yt(t)}}async function Ht(){if(!(!A||!B))try{const e=await Ft();if(B.clearLayers(),!e||e.length===0){console.warn("No initial university data received.");return}if(e.forEach(t=>{const r=lt(Ze),n=L.divIcon({html:r,className:"custom-marker-icon",iconSize:[30,40],iconAnchor:[15,40],popupAnchor:[0,-40]}),a=L.marker([t.location.latitude,t.location.longitude],{icon:n}).bindTooltip(t.universityName);a.on("click",()=>{alert(vt)}),B.addLayer(a)}),e.length>0){const t=L.latLngBounds(e.map(r=>[r.location.latitude,r.location.longitude]));A.fitBounds(t,{padding:[50,50]})}}catch(e){console.error("Error in loadInitialMarkers after API call:",e)}finally{}}function lt(e){return`<svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg"><path d="M15,40 L0,12 Q15,-4 30,12 Z" fill="${e}" stroke="#FFF" stroke-width="1.5"/></svg>`}const Pt={수능:"suneung",교과:"gyogwa",종합:"jonghap"};function qt(e,t){let r,n,a,s=Ze,i=`${e.universityName}<br>${e.departmentName}`;if(t==="경쟁률"&&e.overallCompetitionRate!==void 0){const o=e.overallCompetitionRate,l=1,u=30,y={r:255,g:255,b:255},f={r:102,g:51,b:153},p=Math.min(1,Math.max(0,(o-l)/(u-l)));r=Math.round(y.r*(1-p)+f.r*p),n=Math.round(y.g*(1-p)+f.g*p),a=Math.round(y.b*(1-p)+f.b*p),s=`rgb(${r}, ${n}, ${a})`,i+=`<br>전체 경쟁률: ${o.toFixed(1)} : 1`}else if(t!=="경쟁률"){const o=Pt[t],l=o?e.admissionTypeResults[o]:void 0;if(l&&l.userCalculatedScore!==void 0&&l.lastYearAvgConvertedScore!==void 0){const u=l.userCalculatedScore,y=l.lastYearAvgConvertedScore,f=u-y,p=20,x=-20,N={r:76,g:175,b:80},S={r:3,g:169,b:244},E={r:255,g:193,b:7},m={r:211,g:47,b:47};if(f>=p)({r,g:n,b:a}=N);else if(f>0){const c=f/p;r=Math.round(S.r*(1-c)+N.r*c),n=Math.round(S.g*(1-c)+N.g*c),a=Math.round(S.b*(1-c)+N.b*c)}else if(f>x){const c=(f-x)/Math.abs(x);r=Math.round(E.r*(1-c)+S.r*c),n=Math.round(E.g*(1-c)+S.g*c),a=Math.round(E.b*(1-c)+S.b*c)}else({r,g:n,b:a}=m);s=`rgb(${r}, ${n}, ${a})`,i+=`<br>${t} 전형: 나의 ${u.toFixed(1)} / 작년 ${y.toFixed(1)} (차: ${f.toFixed(1)})`,l.suneungMinSatisfied!==void 0&&t!=="수능"&&(i+=`<br>수능최저: ${l.suneungMinSatisfied?"충족":"미충족"}`)}else t==="종합"&&(l!=null&&l.qualitativeEvaluation)?(s="rgb(150, 150, 150)",i+=`<br>${t} 전형: ${l.qualitativeEvaluation}`,l.suneungMinSatisfied!==void 0&&(i+=`<br>수능최저: ${l.suneungMinSatisfied?"충족":"미충족"}`)):i+=`<br>${t} 전형: 정보 없음`}return{color:s,tooltipText:i}}function de(){if(!(!A||!B)){if(B.clearLayers(),T.length===0){ge&&console.log("No universities match current filters.");return}if(T.forEach(e=>{if(!e.location||typeof e.location.latitude!="number"||typeof e.location.longitude!="number"){console.warn(`University ${e.universityName} has invalid location data. Skipping marker.`);return}const{color:t,tooltipText:r}=qt(e,ne),n=lt(t),a=L.divIcon({html:n,className:"custom-marker-icon",iconSize:[30,40],iconAnchor:[15,40],popupAnchor:[0,-40]}),s=L.marker([e.location.latitude,e.location.longitude],{icon:a}).bindTooltip(r,{direction:"top",offset:L.point(0,-40)});s.on("click",()=>{st(e.universityId,e.departmentName)}),B.addLayer(s)}),T.length>0){const e=T.filter(t=>t.location&&typeof t.location.latitude=="number");if(e.length>0){const t=L.latLngBounds(e.map(r=>[r.location.latitude,r.location.longitude]));A.fitBounds(t,{padding:[50,50],maxZoom:15})}else A.setView([36.5,127.5],7)}else A.setView([36.5,127.5],7)}}let _=null,Me=null,Ae=null,pe=null,Le={},$=null,U=null,Y=null,it=null,H=null,V=null,ut=null,Z=null,ct=null,X=null,dt=null,O=null,Q=null,gt=null,R=null,ee=null,ft=null;function zt(e){_=e.gradeInputModal,Me=e.modalTabsElements,Ae=e.modalTabContentsElements,pe=e.naesinSubjectRowTemplate,Le=e.naesinGradeFormDivs,$=e.suneungExamSelector,U=e.suneungKoreanChoice,Y=e.suneungKoreanRaw,it=e.suneungKoreanCalculatedDiv,H=e.suneungMathChoice,V=e.suneungMathRaw,ut=e.suneungMathCalculatedDiv,Z=e.suneungEnglishRaw,ct=e.suneungEnglishCalculatedDiv,X=e.suneungHistoryRaw,dt=e.suneungHistoryCalculatedDiv,O=e.suneungExplorer1Subject,Q=e.suneungExplorer1Raw,gt=e.suneungExplorer1CalculatedDiv,R=e.suneungExplorer2Subject,ee=e.suneungExplorer2Raw,ft=e.suneungExplorer2CalculatedDiv}function Jt(){if(!_)return;pt(),mt(),bt(),_.classList.remove("hidden");const e=_.querySelector(".tab-button");e&&!e.classList.contains("active")&&e.click()}function Te(){_&&_.classList.add("hidden")}function Wt(e){if(!Me||!Ae)return;const t=e.target;if(!t.classList.contains("tab-button"))return;Me.forEach(n=>n.classList.remove("active")),Ae.forEach(n=>n.classList.remove("active")),t.classList.add("active");const r=t.dataset.tab;if(r){const n=document.getElementById(r);n&&n.classList.add("active")}}function q(e,t,r,n=!1){if(!e||e.options.length>1&&e.dataset.populated==="true"&&e.options[0].text===r)return;const a=e.value;e.innerHTML=`<option value="">${r}</option>`,t.forEach(s=>{const i=document.createElement("option");i.value=n?s.subjectCode:s.subjectName,i.textContent=s.subjectName,i.dataset.subjectCode=s.subjectCode,i.dataset.subjectName=s.subjectName,e.appendChild(i)}),a&&Array.from(e.options).some(s=>s.value===a)&&(e.value=a),e.dataset.populated="true"}function pt(){q(U,rt,"국어 선택",!1),q(H,at,"수학 선택",!1),q(O,Ie,"탐구1 과목 선택",!1),q(R,Ie,"탐구2 과목 선택",!1)}function Yt(e,t){const r=`y${e}s${t}`;if(!Le[r]||!pe)return;const s={id:`s${Date.now()}${Math.random().toString(16).slice(2)}`,subjectCode:null,subjectName:"",grade:null,credits:null,rawScore:null,subjectMean:null,stdDev:null},i=`year${e}`,o=`semester${t}`;h.naesin[i][o].subjects.push(s),me(e,t)}function Vt(e,t,r){const n=`year${e}`,a=`semester${t}`,s=h.naesin[n][a].subjects;h.naesin[n][a].subjects=s.filter(i=>i.id!==r),me(e,t)}function me(e,t){const r=`y${e}s${t}`,n=Le[r];if(!n||!pe)return;n.innerHTML="";const a=`year${e}`,s=`semester${t}`;h.naesin[a][s].subjects.forEach(o=>{var G,j,re,he,M;const u=pe.content.cloneNode(!0).querySelector(".naesin-subject-row");u.dataset.subjectId=o.id;const y=u.querySelector(".naesin-subject-name");q(y,nt,"과목 선택",!0),y.value=o.subjectCode||"",y.addEventListener("change",d=>{const g=d.target.selectedOptions[0];o.subjectCode=g.value,o.subjectName=g.dataset.subjectName||g.textContent||""});const f=u.querySelector(".naesin-subject-grade");f.value=((G=o.grade)==null?void 0:G.toString())||"",f.addEventListener("input",d=>{o.grade=parseInt(d.target.value)||null});const p=u.querySelector(".naesin-subject-credits");p.value=((j=o.credits)==null?void 0:j.toString())||"",p.addEventListener("input",d=>{o.credits=parseInt(d.target.value)||null});const x=u.querySelector(".naesin-subject-details");u.querySelector(".toggle-details-button").addEventListener("click",()=>x.classList.toggle("hidden"));const S=u.querySelector(".naesin-subject-rawScore");S.value=((re=o.rawScore)==null?void 0:re.toString())||"",S.addEventListener("input",d=>{o.rawScore=parseFloat(d.target.value)||null});const E=u.querySelector(".naesin-subject-subjectMean");E.value=((he=o.subjectMean)==null?void 0:he.toString())||"",E.addEventListener("input",d=>{o.subjectMean=parseFloat(d.target.value)||null});const m=u.querySelector(".naesin-subject-stdDev");m.value=((M=o.stdDev)==null?void 0:M.toString())||"",m.addEventListener("input",d=>{o.stdDev=parseFloat(d.target.value)||null}),u.querySelector(".remove-subject-button").addEventListener("click",()=>Vt(e,t,o.id)),n.appendChild(u)})}function mt(){[1,2].forEach(e=>{[1,2].forEach(t=>{me(e,t)})}),me(3,1)}function bt(){var t,r,n,a,s,i;const e=h.suneung;!$||!U||!Y||!H||!V||!Z||!X||!O||!Q||!R||!ee||($.value=e.examIdentifierForCutInfo,e.subjects.korean&&(U.value=e.subjects.korean.selectedOption||"",Y.value=((t=e.subjects.korean.rawScore)==null?void 0:t.toString())||""),e.subjects.math&&(H.value=e.subjects.math.selectedOption||"",V.value=((r=e.subjects.math.rawScore)==null?void 0:r.toString())||""),e.subjects.english&&(Z.value=((n=e.subjects.english.rawScore)==null?void 0:n.toString())||""),e.subjects.history&&(X.value=((a=e.subjects.history.rawScore)==null?void 0:a.toString())||""),e.subjects.explorer1&&(O.value=e.subjects.explorer1.subjectName||"",Q.value=((s=e.subjects.explorer1.rawScore)==null?void 0:s.toString())||""),e.subjects.explorer2&&(R.value=e.subjects.explorer2.subjectName||"",ee.value=((i=e.subjects.explorer2.rawScore)==null?void 0:i.toString())||""),ht())}function F(){var o,l;if(!$||!U||!Y||!H||!V||!Z||!X||!O||!Q||!R||!ee)return;const e=$.value,[t,r]=e.split("_"),n=parseInt(t.substring(0,4)),a=parseInt(t.substring(4,6)),s=h.suneung,i={examYear:n,examMonth:a,examIdentifierForCutInfo:e,subjects:{korean:{...s.subjects.korean,selectedOption:U.value,rawScore:parseFloat(Y.value)||null},math:{...s.subjects.math,selectedOption:H.value,rawScore:parseFloat(V.value)||null},english:{...s.subjects.english,rawScore:parseFloat(Z.value)||null},history:{...s.subjects.history,rawScore:parseFloat(X.value)||null},explorer1:{...s.subjects.explorer1,subjectCode:((o=O.selectedOptions[0])==null?void 0:o.dataset.subjectCode)||null,subjectName:O.value,rawScore:parseFloat(Q.value)||null},explorer2:{...s.subjects.explorer2,subjectCode:((l=R.selectedOptions[0])==null?void 0:l.dataset.subjectCode)||null,subjectName:R.value,rawScore:parseFloat(ee.value)||null}}};It(i),ht()}function Fe(e,t){let r={grade:9};for(const n of t)if(n.rawScoreMin!==void 0&&e>=n.rawScoreMin){if(n.rawScoreMax===void 0||e<=n.rawScoreMax){r={standardScore:n.standardScore,percentile:n.percentile,grade:n.grade};break}}else if(n.rawScoreMin===void 0&&n.rawScoreMax!==void 0&&e<=n.rawScoreMax){r={standardScore:n.standardScore,percentile:n.percentile,grade:n.grade};break}else n.rawScoreMin===void 0&&n.rawScoreMax===void 0&&(r={grade:n.grade});return r.standardScore===void 0&&(r.standardScore=e),r.percentile===void 0&&r.grade&&(r.percentile=Math.max(0,Math.min(100,100-(r.grade*11-5)+Math.floor(Math.random()*3)))),r}function K(e,t){if(!t)return;const n=h.suneung.subjects[e];if(!n||n.rawScore===null||n.rawScore===void 0||!ie||!ie.subjects){t.innerHTML="원점수 입력 또는 등급컷 정보 필요";return}let a={grade:9,standardScore:0,percentile:0};const s=n.rawScore,i=ie.subjects;let o,l;switch(e){case"korean":o="국어",l=n.selectedOption;break;case"math":o="수학",l=n.selectedOption;break;case"english":o="영어";break;case"history":o="한국사";break;case"explorer1":case"explorer2":o=n.subjectName;break}if(o&&i[o]){const u=i[o];Array.isArray(u)?a=Fe(s,u):l&&u[l]&&Array.isArray(u[l])?a=Fe(s,u[l]):!l&&Array.isArray(Object.values(u)[0])&&console.warn(`No specific option for ${o}, or cut data structure mismatch. Using generic approach or first available.`)}n.standardScore=a.standardScore??n.standardScore,n.percentile=a.percentile??n.percentile,n.grade=a.grade??n.grade,t.innerHTML=`계산: 표준 ${n.standardScore??"N/A"}, 백분위 ${n.percentile??"N/A"}%, 등급 ${n.grade??"N/A"}`}function ht(){h.suneung&&(K("korean",it),K("math",ut),K("english",ct),K("history",dt),K("explorer1",gt),K("explorer2",ft))}function Zt(){F();try{const e=JSON.stringify(h,null,2),t=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download=`university_admission_grades_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),alert("성적이 파일로 저장되었습니다.")}catch(e){console.error("Error saving grades to file:",e),alert("성적 저장 중 오류가 발생했습니다.")}}function Xt(e){var a;const t=e.target,r=(a=t.files)==null?void 0:a[0];if(!r)return;const n=new FileReader;n.onload=async s=>{var i,o,l,u,y,f,p,x,N;try{const S=(i=s.target)==null?void 0:i.result,E=JSON.parse(S);if(E.naesin&&E.suneung&&E.suneung.examIdentifierForCutInfo){const m=tt(),c=E.naesin,G=m.naesin;for(const M of["year1","year2","year3"])for(const d of["semester1","semester2"]){if(M==="year3"&&d==="semester2"){G[M][d].subjects=[];continue}(l=(o=c[M])==null?void 0:o[d])!=null&&l.subjects&&(G[M][d].subjects=c[M][d].subjects.map(g=>({id:g.id||`loaded${Date.now()}${Math.random()}`,subjectCode:g.subjectCode||null,subjectName:g.subjectName||"",grade:g.grade===void 0?null:g.grade,credits:g.credits===void 0?null:g.credits,rawScore:g.rawScore===void 0?null:g.rawScore,subjectMean:g.subjectMean===void 0?null:g.subjectMean,stdDev:g.stdDev===void 0?null:g.stdDev})))}const j=E.suneung,re={...m.suneung,examYear:j.examYear||m.suneung.examYear,examMonth:j.examMonth||m.suneung.examMonth,examIdentifierForCutInfo:j.examIdentifierForCutInfo,subjects:{korean:{...m.suneung.subjects.korean,...(u=j.subjects)==null?void 0:u.korean},math:{...m.suneung.subjects.math,...(y=j.subjects)==null?void 0:y.math},english:{...m.suneung.subjects.english,...(f=j.subjects)==null?void 0:f.english},history:{...m.suneung.subjects.history,...(p=j.subjects)==null?void 0:p.history},explorer1:{...m.suneung.subjects.explorer1,...(x=j.subjects)==null?void 0:x.explorer1},explorer2:{...m.suneung.subjects.explorer2,...(N=j.subjects)==null?void 0:N.explorer2}}};wt({naesin:G,suneung:re}),mt(),bt(),$&&h.suneung.examIdentifierForCutInfo&&($.value=h.suneung.examIdentifierForCutInfo,await Ne($.value),F()),alert("성적을 파일에서 불러왔습니다.")}else alert("불러온 파일이 유효한 성적 데이터 형식이 아닙니다. (필수 항목 누락)")}catch(S){console.error("Error parsing JSON from file or applying grades:",S),alert("성적 파일을 읽거나 적용하는 중 오류가 발생했습니다.")}finally{t.value=""}},n.readAsText(r)}const Qt=document.getElementById("department-search"),en=document.getElementById("department-suggestions"),tn=document.getElementById("enter-grades-button"),Be=document.getElementById("admission-type-filter"),Ee=document.getElementById("score-difference-tolerance"),je=document.getElementById("score-difference-tolerance-slider"),nn=document.getElementById("apply-filters-button"),Oe=document.getElementById("map"),Re=document.getElementById("sidebar"),rn=document.getElementById("sidebar-content"),an=document.getElementById("close-sidebar-button"),sn=document.getElementById("loading-overlay"),be=document.getElementById("grade-input-modal"),on=document.getElementById("close-grade-modal-button"),ln=document.getElementById("save-grades-button"),Ge=document.getElementById("load-grades-input"),un=document.getElementById("load-grades-button"),Ke=be.querySelectorAll(".tab-button"),cn=be.querySelectorAll(".tab-content"),dn=document.getElementById("submit-grades-button"),gn=document.getElementById("naesin-subject-row-template"),fn={y1s1:document.getElementById("naesin-y1s1-subjects"),y1s2:document.getElementById("naesin-y1s2-subjects"),y2s1:document.getElementById("naesin-y2s1-subjects"),y2s2:document.getElementById("naesin-y2s2-subjects"),y3s1:document.getElementById("naesin-y3s1-subjects"),y3s2:document.getElementById("naesin-y3s2-subjects")},D=document.getElementById("suneung-exam-selector"),_e=document.getElementById("suneung-korean-choice"),Ue=document.getElementById("suneung-korean-raw"),pn=document.getElementById("suneung-korean-calculated"),He=document.getElementById("suneung-math-choice"),Pe=document.getElementById("suneung-math-raw"),mn=document.getElementById("suneung-math-calculated"),qe=document.getElementById("suneung-english-raw"),bn=document.getElementById("suneung-english-calculated"),ze=document.getElementById("suneung-history-raw"),hn=document.getElementById("suneung-history-calculated"),Je=document.getElementById("suneung-explorer1-subject"),We=document.getElementById("suneung-explorer1-raw"),vn=document.getElementById("suneung-explorer1-calculated"),Ye=document.getElementById("suneung-explorer2-subject"),Ve=document.getElementById("suneung-explorer2-raw"),yn=document.getElementById("suneung-explorer2-calculated");function Sn(e){const t={};for(const r of[1,2,3])for(const n of[1,2]){if(r===3&&n===2)continue;const a=`year${r}`,s=`semester${n}`,i=e[a][s].subjects;if(i.length>0){const o=`${r}-${n}`;t[o]=i.map(l=>({id:l.id,subjectCode:l.subjectCode||"N/A",subjectName:l.subjectName,grade:l.grade,credits:l.credits,rawScore:l.rawScore,subjectMean:l.subjectMean,stdDev:l.stdDev}))}}return t}async function En(){if(!ge){alert("학과를 먼저 선택해주세요."),ae([]),de();return}F();try{const e=Sn(h.naesin),t=h.suneung,r={userGrades:{naesin:e,suneung:t},filterCriteria:{departmentKeywords:ge,admissionType:ne,scoreDifferenceTolerance:z}};console.log("Sending to /universities/filter:",JSON.stringify(r,null,2));const n=await Gt(r);n&&Array.isArray(n)?ae(n):(console.error("Invalid data from fetchFilteredUniversitiesApi or API call failed."),ae([])),de(),W&&!T.find(a=>a.universityId===W)&&ot()}catch(e){console.error("Error in handleFilterUpdate after API call:",e),ae([]),de()}finally{}}document.addEventListener("DOMContentLoaded",async()=>{Lt({loadingOverlay:sn,departmentSearchInput:Qt,departmentSuggestionsDiv:en}),_t(Re,rn,an),zt({gradeInputModal:be,modalTabsElements:Ke,modalTabContentsElements:cn,naesinSubjectRowTemplate:gn,naesinGradeFormDivs:fn,suneungExamSelector:D,suneungKoreanChoice:_e,suneungKoreanRaw:Ue,suneungKoreanCalculatedDiv:pn,suneungMathChoice:He,suneungMathRaw:Pe,suneungMathCalculatedDiv:mn,suneungEnglishRaw:qe,suneungEnglishCalculatedDiv:bn,suneungHistoryRaw:ze,suneungHistoryCalculatedDiv:hn,suneungExplorer1Subject:Je,suneungExplorer1Raw:We,suneungExplorer1CalculatedDiv:vn,suneungExplorer2Subject:Ye,suneungExplorer2Raw:Ve,suneungExplorer2CalculatedDiv:yn}),Oe?Ut(Oe):console.error("Map container not found!"),await Ht(),await Ot(),D&&D.value&&await Ne(D.value),pt(),Ee.value=z.toString(),je.value=z.toString(),Be.value=ne,tn.addEventListener("click",Jt),Be.addEventListener("change",e=>{Et(e.target.value),Re.classList.contains("visible")&&w&&W?st(W,w.departmentName):w&&ce(),T.length>0&&de()}),Ee.addEventListener("change",e=>{const t=parseFloat(e.target.value);!isNaN(t)&&t>=0&&t<=100?($e(t),je.value=t.toString()):(e.target.value=z.toString(),alert("유효한 점수차 허용치를 입력해주세요 (0 ~ 100)."))}),je.addEventListener("input",e=>{const t=parseFloat(e.target.value);$e(t),Ee.value=t.toFixed(0)}),nn.addEventListener("click",En),on.addEventListener("click",Te),dn.addEventListener("click",()=>{F(),Te(),alert("성적이 반영되었습니다. '필터 적용 및 지도 업데이트' 버튼을 클릭하여 결과를 확인하세요.")}),ln.addEventListener("click",Zt),un.addEventListener("click",()=>Ge.click()),Ge.addEventListener("change",Xt),Ke.forEach(e=>e.addEventListener("click",Wt)),be.querySelectorAll(".add-subject-button").forEach(e=>{e.addEventListener("click",t=>{const r=t.target,n=parseInt(r.dataset.year),a=parseInt(r.dataset.semester);n&&a&&Yt(n,a)})}),D.addEventListener("change",async()=>{D&&(await Ne(D.value),F())}),[Ue,Pe,qe,ze,We,Ve,_e,He,Je,Ye].forEach(e=>{e&&(e.addEventListener("change",()=>{F()}),e.addEventListener("input",()=>{e.type==="number"&&F()}))}),console.log("Application initialized with real fetch API calls.")});
