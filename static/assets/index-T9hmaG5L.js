(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();const A="/api",tt="#cccccc",wt="학과와 성적을 입력하고 필터를 적용하여 상세 정보를 확인하세요.",Z=[{subjectCode:"SA01",subjectName:"생활과 윤리"},{subjectCode:"SA02",subjectName:"윤리와 사상"},{subjectCode:"SA03",subjectName:"한국지리"},{subjectCode:"SA04",subjectName:"세계지리"},{subjectCode:"SA05",subjectName:"동아시아사"},{subjectCode:"SA06",subjectName:"세계사"},{subjectCode:"SA07",subjectName:"경제"},{subjectCode:"SA08",subjectName:"정치와 법"},{subjectCode:"SA09",subjectName:"사회·문화"},{subjectCode:"SC01",subjectName:"물리학Ⅰ"},{subjectCode:"SC02",subjectName:"화학Ⅰ"},{subjectCode:"SC03",subjectName:"생명과학Ⅰ"},{subjectCode:"SC04",subjectName:"지구과학Ⅰ"},{subjectCode:"SC05",subjectName:"물리학Ⅱ"},{subjectCode:"SC06",subjectName:"화학Ⅱ"},{subjectCode:"SC07",subjectName:"생명과학Ⅱ"},{subjectCode:"SC08",subjectName:"지구과학Ⅱ"}],Ae=[{subjectCode:"KOR_OPT_HWAPJAK",subjectName:"화법과 작문"},{subjectCode:"KOR_OPT_EONMAE",subjectName:"언어와 매체"}],ke=[{subjectCode:"MAT_OPT_HWAKTONG",subjectName:"확률과 통계"},{subjectCode:"MAT_OPT_MIJEOK",subjectName:"미적분"},{subjectCode:"MAT_OPT_GIHA",subjectName:"기하"}];let D=null;function Ct(e){D=e}let B=null;function Et(e){B=e}let F=[];function ie(e){F=e}let me=null;function nt(e){me=e}let V=10;function De(e){V=e}let se="경쟁률";function Mt(e){se=e}let x=null;function W(e){x=e}let R=-1;function pe(e){R=e}let Q=null;function at(e){Q=e}function Fe(){return{subjects:[]}}function ve(){return{semester1:Fe(),semester2:Fe()}}function Nt(){return{year1:ve(),year2:ve(),year3:ve()}}function It(){var r,s;const e=((r=Ae[0])==null?void 0:r.subjectName)||"",n=((s=ke[0])==null?void 0:s.subjectName)||"",a=Z[0],t=Z[1];return{examYear:2024,examMonth:11,examIdentifierForCutInfo:"202411_csat",subjects:{korean:{selectedOption:e,rawScore:null,standardScore:null,percentile:null,grade:null},math:{selectedOption:n,rawScore:null,standardScore:null,percentile:null,grade:null},english:{rawScore:null,standardScore:null,percentile:null,grade:null},history:{rawScore:null,standardScore:null,percentile:null,grade:null},explorer1:{subjectCode:a==null?void 0:a.subjectCode,subjectName:a==null?void 0:a.subjectName,rawScore:null,standardScore:null,percentile:null,grade:null},explorer2:{subjectCode:t==null?void 0:t.subjectCode,subjectName:t==null?void 0:t.subjectName,rawScore:null,standardScore:null,percentile:null,grade:null}}}}function rt(){return{naesin:Nt(),suneung:It()}}let M=rt();function xt(e){M=e}function $t(e){M.suneung=e}let st=[];function At(e){st=e}let ot=Ae;function kt(e){ot=e}let it=ke;function Tt(e){it=e}let Me=Z;function Lt(e){Me=e}let le=null;function ce(e){le=e}let Ne=null,I=null,N=null;function Dt(e){Ne=e.loadingOverlay,I=e.departmentSearchInput,N=e.departmentSuggestionsDiv,I&&(I.addEventListener("input",Rt),I.addEventListener("keydown",Bt)),document.addEventListener("click",n=>{if(!I||!N)return;I.contains(n.target)||N.contains(n.target)||be()})}function Ft(e,n){let a=null;return(...t)=>new Promise(r=>{a&&clearTimeout(a),a=setTimeout(()=>r(e(...t)),n)})}function O(e){Ne&&(Ne.style.display=e?"flex":"none",document.body.setAttribute("aria-busy",e.toString()))}async function Ot(e){if(!I||!N)return;const n=e.target.value;if(n.length<1){ye([]);return}try{const a=await Y(`${A}/departments/suggest?query=${encodeURIComponent(n)}`);ye(a)}catch(a){console.error("Error fetching department suggestions:",a),ye([])}}const Rt=Ft(Ot,250);function ye(e){!N||!I||(N.innerHTML="",pe(-1),e.length>0?(e.forEach((n,a)=>{const t=document.createElement("div");t.textContent=n.departmentName,t.setAttribute("role","option"),t.setAttribute("id",`suggestion-${a}`),t.tabIndex=-1,t.addEventListener("click",()=>{I.value=n.departmentName,nt(n.departmentName),be()}),N.appendChild(t)}),N.style.display="block"):N.style.display="none")}function be(){N&&(N.innerHTML="",N.style.display="none"),pe(-1)}function Bt(e){if(!N||!I)return;const n=N.querySelectorAll('div[role="option"]');if(!(n.length===0&&e.key!=="Escape"))switch(e.key){case"ArrowDown":e.preventDefault(),pe(Math.min(R+1,n.length-1)),Oe(n);break;case"ArrowUp":e.preventDefault(),pe(Math.max(R-1,0)),Oe(n);break;case"Enter":e.preventDefault(),R>-1&&R<n.length?n[R].click():n.length>0&&I.value.trim()!==""&&(nt(I.value.trim()),be());break;case"Escape":be();break;default:return}}function Oe(e){I&&e.forEach((n,a)=>{const t=a===R;n.classList.toggle("selected",t),n.setAttribute("aria-selected",t.toString()),t&&n.focus()})}let U=null,Ie=null,xe=null,fe=null,Te={},T=null,P=null,X=null,ct=null,q=null,ee=null,ut=null,te=null,lt=null,ne=null,dt=null,G=null,ae=null,gt=null,K=null,re=null,mt=null;function Gt(e){U=e.gradeInputModal,Ie=e.modalTabsElements,xe=e.modalTabContentsElements,fe=e.naesinSubjectRowTemplate,Te=e.naesinGradeFormDivs,T=e.suneungExamSelector,P=e.suneungKoreanChoice,X=e.suneungKoreanRaw,ct=e.suneungKoreanCalculatedDiv,q=e.suneungMathChoice,ee=e.suneungMathRaw,ut=e.suneungMathCalculatedDiv,te=e.suneungEnglishRaw,lt=e.suneungEnglishCalculatedDiv,ne=e.suneungHistoryRaw,dt=e.suneungHistoryCalculatedDiv,G=e.suneungExplorer1Subject,ae=e.suneungExplorer1Raw,gt=e.suneungExplorer1CalculatedDiv,K=e.suneungExplorer2Subject,re=e.suneungExplorer2Raw,mt=e.suneungExplorer2CalculatedDiv}function Kt(){if(!U)return;pt(),bt(),ft(),U.classList.remove("hidden");const e=U.querySelector(".tab-button");e&&!e.classList.contains("active")&&e.click()}function Re(){U&&U.classList.add("hidden")}function Ht(e){if(!Ie||!xe)return;const n=e.target;if(!n.classList.contains("tab-button"))return;Ie.forEach(t=>t.classList.remove("active")),xe.forEach(t=>t.classList.remove("active")),n.classList.add("active");const a=n.dataset.tab;if(a){const t=document.getElementById(a);t&&t.classList.add("active")}}function J(e,n,a,t=!1){if(!e||e.options.length>1&&e.dataset.populated==="true"&&e.options[0].text===a)return;const r=e.value;e.innerHTML=`<option value="">${a}</option>`,n.forEach(s=>{const o=document.createElement("option");o.value=t?s.subjectCode:s.subjectName,o.textContent=s.subjectName,o.dataset.subjectCode=s.subjectCode,o.dataset.subjectName=s.subjectName,e.appendChild(o)}),r&&Array.from(e.options).some(s=>s.value===r)&&(e.value=r),e.dataset.populated="true"}function pt(){J(P,ot,"국어 선택",!1),J(q,it,"수학 선택",!1),J(G,Me,"탐구1 과목 선택",!1),J(K,Me,"탐구2 과목 선택",!1)}function Ut(e,n){const a=`y${e}s${n}`;if(!Te[a]||!fe)return;const s={id:`s${Date.now()}${Math.random().toString(16).slice(2)}`,subjectCode:null,subjectName:"",grade:null,credits:null,rawScore:null,subjectMean:null,stdDev:null},o=`year${e}`,i=`semester${n}`;M.naesin[o][i].subjects.push(s),Se(e,n)}function _t(e,n,a){const t=`year${e}`,r=`semester${n}`,s=M.naesin[t][r].subjects;M.naesin[t][r].subjects=s.filter(o=>o.id!==a),Se(e,n)}function Se(e,n){const a=`y${e}s${n}`,t=Te[a];if(!t||!fe)return;t.innerHTML="";const r=`year${e}`,s=`semester${n}`;M.naesin[r][s].subjects.forEach(i=>{var C,d,E,w,$;const m=fe.content.cloneNode(!0).querySelector(".naesin-subject-row");m.dataset.subjectId=i.id;const j=m.querySelector(".naesin-subject-name");J(j,st,"과목 선택",!0),j.value=i.subjectCode||"",j.addEventListener("change",f=>{const S=f.target.selectedOptions[0];i.subjectCode=S.value,i.subjectName=S.dataset.subjectName||S.textContent||""});const h=m.querySelector(".naesin-subject-grade");h.value=((C=i.grade)==null?void 0:C.toString())||"",h.addEventListener("input",f=>{i.grade=parseInt(f.target.value)||null});const u=m.querySelector(".naesin-subject-credits");u.value=((d=i.credits)==null?void 0:d.toString())||"",u.addEventListener("input",f=>{i.credits=parseInt(f.target.value)||null});const b=m.querySelector(".naesin-subject-details");m.querySelector(".toggle-details-button").addEventListener("click",()=>b.classList.toggle("hidden"));const l=m.querySelector(".naesin-subject-rawScore");l.value=((E=i.rawScore)==null?void 0:E.toString())||"",l.addEventListener("input",f=>{i.rawScore=parseFloat(f.target.value)||null});const g=m.querySelector(".naesin-subject-subjectMean");g.value=((w=i.subjectMean)==null?void 0:w.toString())||"",g.addEventListener("input",f=>{i.subjectMean=parseFloat(f.target.value)||null});const y=m.querySelector(".naesin-subject-stdDev");y.value=(($=i.stdDev)==null?void 0:$.toString())||"",y.addEventListener("input",f=>{i.stdDev=parseFloat(f.target.value)||null}),m.querySelector(".remove-subject-button").addEventListener("click",()=>_t(e,n,i.id)),t.appendChild(m)})}function bt(){[1,2].forEach(e=>{[1,2].forEach(n=>{Se(e,n)})}),Se(3,1)}function ft(){var n,a,t,r,s,o;const e=M.suneung;!T||!P||!X||!q||!ee||!te||!ne||!G||!ae||!K||!re||(T.value=e.examIdentifierForCutInfo,e.subjects.korean&&(P.value=e.subjects.korean.selectedOption||"",X.value=((n=e.subjects.korean.rawScore)==null?void 0:n.toString())||""),e.subjects.math&&(q.value=e.subjects.math.selectedOption||"",ee.value=((a=e.subjects.math.rawScore)==null?void 0:a.toString())||""),e.subjects.english&&(te.value=((t=e.subjects.english.rawScore)==null?void 0:t.toString())||""),e.subjects.history&&(ne.value=((r=e.subjects.history.rawScore)==null?void 0:r.toString())||""),e.subjects.explorer1&&(G.value=e.subjects.explorer1.subjectName||"",ae.value=((s=e.subjects.explorer1.rawScore)==null?void 0:s.toString())||""),e.subjects.explorer2&&(K.value=e.subjects.explorer2.subjectName||"",re.value=((o=e.subjects.explorer2.rawScore)==null?void 0:o.toString())||""),St())}function _(){var i,c;if(!T||!P||!X||!q||!ee||!te||!ne||!G||!ae||!K||!re)return;const e=T.value,[n,a]=e.split("_"),t=parseInt(n.substring(0,4)),r=parseInt(n.substring(4,6)),s=M.suneung,o={examYear:t,examMonth:r,examIdentifierForCutInfo:e,subjects:{korean:{...s.subjects.korean,selectedOption:P.value,rawScore:parseFloat(X.value)||null},math:{...s.subjects.math,selectedOption:q.value,rawScore:parseFloat(ee.value)||null},english:{...s.subjects.english,rawScore:parseFloat(te.value)||null},history:{...s.subjects.history,rawScore:parseFloat(ne.value)||null},explorer1:{...s.subjects.explorer1,subjectCode:((i=G.selectedOptions[0])==null?void 0:i.dataset.subjectCode)||null,subjectName:G.value,rawScore:parseFloat(ae.value)||null},explorer2:{...s.subjects.explorer2,subjectCode:((c=K.selectedOptions[0])==null?void 0:c.dataset.subjectCode)||null,subjectName:K.value,rawScore:parseFloat(re.value)||null}}};$t(o),St()}function Be(e,n){let a={grade:9};for(const t of n)if(t.rawScoreMin!==void 0&&e>=t.rawScoreMin){if(t.rawScoreMax===void 0||e<=t.rawScoreMax){a={standardScore:t.standardScore,percentile:t.percentile,grade:t.grade};break}}else if(t.rawScoreMin===void 0&&t.rawScoreMax!==void 0&&e<=t.rawScoreMax){a={standardScore:t.standardScore,percentile:t.percentile,grade:t.grade};break}else t.rawScoreMin===void 0&&t.rawScoreMax===void 0&&(a={grade:t.grade});return a.standardScore===void 0&&(a.standardScore=e),a.percentile===void 0&&a.grade&&(a.percentile=Math.max(0,Math.min(100,100-(a.grade*11-5)+Math.floor(Math.random()*3)))),a}function H(e,n){if(!n)return;const t=M.suneung.subjects[e];if(!t||t.rawScore===null||t.rawScore===void 0||!le||!le.subjects){n.innerHTML="원점수 입력 또는 등급컷 정보 필요";return}let r={grade:9,standardScore:0,percentile:0};const s=t.rawScore,o=le.subjects;let i,c;switch(e){case"korean":i="국어",c=t.selectedOption;break;case"math":i="수학",c=t.selectedOption;break;case"english":i="영어";break;case"history":i="한국사";break;case"explorer1":case"explorer2":i=t.subjectName;break}if(i&&o[i]){const m=o[i];Array.isArray(m)?r=Be(s,m):c&&m[c]&&Array.isArray(m[c])?r=Be(s,m[c]):!c&&Array.isArray(Object.values(m)[0])&&console.warn(`No specific option for ${i}, or cut data structure mismatch. Using generic approach or first available.`)}t.standardScore=r.standardScore??t.standardScore,t.percentile=r.percentile??t.percentile,t.grade=r.grade??t.grade,n.innerHTML=`계산: 표준 ${t.standardScore??"N/A"}, 백분위 ${t.percentile??"N/A"}%, 등급 ${t.grade??"N/A"}`}function St(){M.suneung&&(H("korean",ct),H("math",ut),H("english",lt),H("history",dt),H("explorer1",gt),H("explorer2",mt))}async function $e(){T&&(await Jt(T.value),_())}function Pt(){_();try{const e=JSON.stringify(M,null,2),n=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(n),t=document.createElement("a");t.href=a,t.download=`university_admission_grades_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(a),alert("성적이 파일로 저장되었습니다.")}catch(e){console.error("Error saving grades to file:",e),alert("성적 저장 중 오류가 발생했습니다.")}}function qt(e){var r;const n=e.target,a=(r=n.files)==null?void 0:r[0];if(!a)return;const t=new FileReader;t.onload=s=>{var o,i,c,m,j,h,u,b,v;try{const l=(o=s.target)==null?void 0:o.result,g=JSON.parse(l);if(g.naesin&&g.suneung&&g.suneung.examIdentifierForCutInfo){const y=rt(),p=g.naesin,C=y.naesin;for(const $ of["year1","year2","year3"])for(const f of["semester1","semester2"]){if($==="year3"&&f==="semester2"){C[$][f].subjects=[];continue}(c=(i=p[$])==null?void 0:i[f])!=null&&c.subjects&&(C[$][f].subjects=p[$][f].subjects.map(S=>({id:S.id||`loaded${Date.now()}${Math.random()}`,subjectCode:S.subjectCode||null,subjectName:S.subjectName||"",grade:S.grade===void 0?null:S.grade,credits:S.credits===void 0?null:S.credits,rawScore:S.rawScore===void 0?null:S.rawScore,subjectMean:S.subjectMean===void 0?null:S.subjectMean,stdDev:S.stdDev===void 0?null:S.stdDev})))}const d=g.suneung,E={...y.suneung,examYear:d.examYear||y.suneung.examYear,examMonth:d.examMonth||y.suneung.examMonth,examIdentifierForCutInfo:d.examIdentifierForCutInfo,subjects:{korean:{...y.suneung.subjects.korean,...(m=d.subjects)==null?void 0:m.korean},math:{...y.suneung.subjects.math,...(j=d.subjects)==null?void 0:j.math},english:{...y.suneung.subjects.english,...(h=d.subjects)==null?void 0:h.english},history:{...y.suneung.subjects.history,...(u=d.subjects)==null?void 0:u.history},explorer1:{...y.suneung.subjects.explorer1,...(b=d.subjects)==null?void 0:b.explorer1},explorer2:{...y.suneung.subjects.explorer2,...(v=d.subjects)==null?void 0:v.explorer2}}};xt({naesin:C,suneung:E}),bt(),ft(),T&&M.suneung.examIdentifierForCutInfo&&(T.value=M.suneung.examIdentifierForCutInfo,$e()),alert("성적을 파일에서 불러왔습니다.")}else alert("불러온 파일이 유효한 성적 데이터 형식이 아닙니다. (필수 항목 누락)")}catch(l){console.error("Error parsing JSON from file or applying grades:",l),alert("성적 파일을 읽거나 적용하는 중 오류가 발생했습니다.")}finally{n.value=""}},t.readAsText(a)}const Yt={수능:"suneung",교과:"gyogwa",종합:"jonghap"},je=[{universityId:"SNU001",universityName:"서울대학교",location:{latitude:37.459,longitude:126.9519}},{universityId:"KU003",universityName:"고려대학교",location:{latitude:37.589,longitude:127.0323}},{universityId:"YSU002",universityName:"연세대학교",location:{latitude:37.565,longitude:126.9386}},{universityId:"HGU004",universityName:"한양대학교",location:{latitude:37.5569,longitude:127.0455}},{universityId:"SKKU005",universityName:"성균관대학교",location:{latitude:37.588,longitude:126.9937}},{universityId:"PNU006",universityName:"부산대학교",location:{latitude:35.2337,longitude:129.082}},{universityId:"KNU007",universityName:"경북대학교",location:{latitude:35.8883,longitude:128.6103}}];function zt(e){const n={};for(const a of[1,2,3])for(const t of[1,2]){if(a===3&&t===2)continue;const r=`year${a}`,s=`semester${t}`,o=e[r][s].subjects;o.length>0&&(n[`${a}-${t}`]=o.map(i=>({id:i.id,subjectCode:i.subjectCode||"N/A",subjectName:i.subjectName,grade:i.grade,credits:i.credits,rawScore:i.rawScore,subjectMean:i.subjectMean,stdDev:i.stdDev})))}return n}async function Y(e,n){var i,c,m,j,h;const a=(n==null?void 0:n.method)||"GET",t=new URL(e,window.location.origin),r=t.searchParams,s=n!=null&&n.body?JSON.parse(n.body):{};console.log(`Mock API Call: ${a} ${t.pathname}${t.search}`,s),O(!0);let o;try{if(await new Promise(u=>setTimeout(u,300+Math.random()*400)),t.pathname==="/map/initial-data")o=je.slice(0,5).map(u=>({...u}));else if(t.pathname===`${A}/departments/suggest`){const u=((i=r.get("query"))==null?void 0:i.toLowerCase())||"";o=u?[{departmentName:"컴퓨터공학과",keywords:["컴퓨터","AI","소프트웨어","정보통신","IT"]},{departmentName:"컴퓨터과학부",keywords:["컴퓨터","과학","데이터"]},{departmentName:"전자공학과",keywords:["전자","반도체","통신","회로"]},{departmentName:"기계공학과",keywords:["기계","로봇","자동차"]},{departmentName:"경영학과",keywords:["경영","경제","마케팅"]},{departmentName:"화학공학과",keywords:["화학","재료","생명"]},{departmentName:"신소재공학과",keywords:["신소재","재료","나노"]}].filter(v=>v.departmentName.toLowerCase().includes(u)||v.keywords.some(l=>l.toLowerCase().includes(u))):[]}else if(t.pathname===`${A}/subjects`){const u=r.get("type");u==="naesin"?o=[{subjectCode:"KOR001",subjectName:"국어"},{subjectCode:"KOR002",subjectName:"문학"},{subjectCode:"KOR003",subjectName:"독서"},{subjectCode:"MAT001",subjectName:"수학"},{subjectCode:"MAT002",subjectName:"수학Ⅰ"},{subjectCode:"MAT003",subjectName:"수학Ⅱ"},{subjectCode:"ENG001",subjectName:"영어"},{subjectCode:"ENG002",subjectName:"영어Ⅰ"},{subjectCode:"SOC001",subjectName:"통합사회"},{subjectCode:"SCI001",subjectName:"통합과학"},{subjectCode:"HIS001",subjectName:"한국사"},{subjectCode:"PHY001",subjectName:"물리학I"},{subjectCode:"CHE001",subjectName:"화학I"},{subjectCode:"BIO001",subjectName:"생명과학I"},{subjectCode:"EAR001",subjectName:"지구과학I"},{subjectCode:"ETH001",subjectName:"생활과 윤리"},{subjectCode:"GEO001",subjectName:"세계지리"},{subjectCode:"LAW001",subjectName:"정치와 법"},{subjectCode:"ECO001",subjectName:"경제"},{subjectCode:"MAT004",subjectName:"미적분"},{subjectCode:"MAT005",subjectName:"확률과 통계"}]:u==="suneung_탐구"?o=Z:u==="suneung_국어"?o=Ae:u==="suneung_수학"?o=ke:o=[]}else if(t.pathname===`${A}/exam-grade-cuts`){const u=r.get("year"),b=r.get("month"),l={examName:`${u}년 ${b}월 모의고사${b==="11"?" (수능)":""}`,subjects:{국어:{"언어와 매체":[{rawScoreMin:90,standardScore:135,percentile:98,grade:1},{rawScoreMin:85,standardScore:130,percentile:95,grade:1},{rawScoreMin:80,standardScore:125,percentile:89,grade:2},{rawScoreMin:70,standardScore:117,percentile:77,grade:3},{rawScoreMin:60,standardScore:109,percentile:60,grade:4},{rawScoreMin:50,standardScore:100,percentile:40,grade:5},{rawScoreMin:0,grade:9}],"화법과 작문":[{rawScoreMin:92,standardScore:133,percentile:97,grade:1},{rawScoreMin:87,standardScore:128,percentile:94,grade:1},{rawScoreMin:82,standardScore:123,percentile:88,grade:2},{rawScoreMin:72,standardScore:115,percentile:76,grade:3},{rawScoreMin:62,standardScore:107,percentile:59,grade:4},{rawScoreMin:52,standardScore:98,percentile:39,grade:5},{rawScoreMin:0,grade:9}]},수학:{미적분:[{rawScoreMin:88,standardScore:145,percentile:99,grade:1},{rawScoreMin:80,grade:1},{rawScoreMin:70,grade:2},{rawScoreMin:0,grade:9}],기하:[{rawScoreMin:90,standardScore:142,percentile:98,grade:1},{rawScoreMin:82,grade:1},{rawScoreMin:72,grade:2},{rawScoreMin:0,grade:9}],"확률과 통계":[{rawScoreMin:92,standardScore:138,percentile:97,grade:1},{rawScoreMin:85,grade:1},{rawScoreMin:75,grade:2},{rawScoreMin:0,grade:9}]},영어:[{rawScoreMin:90,grade:1},{rawScoreMin:80,grade:2},{rawScoreMin:70,grade:3},{rawScoreMin:60,grade:4},{rawScoreMin:50,grade:5},{rawScoreMin:0,grade:9}],한국사:[{rawScoreMin:40,grade:1},{rawScoreMin:35,grade:2},{rawScoreMin:30,grade:3},{rawScoreMin:25,grade:4},{rawScoreMin:20,grade:5},{rawScoreMin:0,grade:9}]}};Z.forEach(g=>{l.subjects[g.subjectName]=[{rawScoreMin:45,standardScore:70,percentile:96,grade:1},{rawScoreMin:40,grade:1},{rawScoreMin:35,grade:2},{rawScoreMin:30,grade:3},{rawScoreMin:25,grade:4},{rawScoreMin:20,grade:5},{rawScoreMin:0,grade:9}]}),o=l}else if(t.pathname===`${A}/universities/filter`){const{userGrades:u,filterCriteria:b}=s,v=zt(u.naesin),l=u.suneung;console.log("Transformed Naesin for API:",v),console.log("Suneung for API:",l),o=je.map(g=>{var f,S,Le;const y=b.departmentKeywords||"컴퓨터공학과";let p=!0;const C=((f=l.subjects.english)==null?void 0:f.grade)||5,d=600+(5-C)*30+Math.random()*50,E=(((S=l.subjects.korean)==null?void 0:S.grade)??9)<=4&&(((Le=l.subjects.math)==null?void 0:Le.grade)??9)<=4,w={suneung:{userCalculatedScore:parseFloat((d+Math.random()*30).toFixed(2)),lastYearAvgConvertedScore:parseFloat((d-10+Math.random()*40).toFixed(2)),lastYear70CutConvertedScore:parseFloat((d-20+Math.random()*35).toFixed(2)),suneungMinSatisfied:!0},gyogwa:{userCalculatedScore:parseFloat((950+d/10+Math.random()*20).toFixed(2)),lastYearAvgConvertedScore:parseFloat((945+d/10+Math.random()*20).toFixed(2)),lastYear70CutConvertedScore:parseFloat((940+d/10+Math.random()*15).toFixed(2)),suneungMinSatisfied:E},jonghap:{userCalculatedScore:void 0,lastYearAvgConvertedScore:void 0,qualitativeEvaluation:["매우 우수","우수","보통","개선 필요"][Math.floor(Math.random()*4)],suneungMinSatisfied:E}},$=parseFloat(Math.max(1,Math.random()*20+3-C).toFixed(1));if(b.admissionType!=="경쟁률"){const oe=Yt[b.admissionType];if(oe&&w[oe]){const z=w[oe];b.scoreDifferenceTolerance!==void 0&&z.userCalculatedScore!==void 0&&z.lastYearAvgConvertedScore!==void 0?Math.abs(z.userCalculatedScore-z.lastYearAvgConvertedScore)>b.scoreDifferenceTolerance&&(p=!1):z.userCalculatedScore===void 0&&oe!=="jonghap"&&(p=!1)}else p=!1}return p?{...g,departmentName:y,admissionTypeResults:w,overallCompetitionRate:$}:null}).filter(Boolean)}else if(t.pathname.includes(`${A}/universities`)&&t.pathname.includes("/sidebar-details")){const u=t.pathname.split("/")[3],b=r.get("departmentName")||"정보 없음",v=r.get("admissionTypeFilter")||"경쟁률",l=F.find(E=>E.universityId===u),g=je.find(E=>E.universityId===u),y=(l==null?void 0:l.universityName)||(g==null?void 0:g.universityName)||"알 수 없는 대학",p=[];p.push({sectionTitle:"대학 소개",isHighlighted:!1,items:[{label:"인재상",value:"창의적 지식인"},{label:"비전",value:"세계를 선도"}],notes:["2025학년도 모집요강 기준"]});let C="",d=null;if(l!=null&&l.admissionTypeResults){const E=l.admissionTypeResults;switch(v){case"수능":C=`수능 위주 전형 (${b})`,d=E.suneung;break;case"교과":C=`학생부교과 전형 (${b})`,d=E.gyogwa;break;case"종합":C=`학생부종합 전형 (${b})`,d=E.jonghap;break;case"경쟁률":C=`전체 경쟁률 (${b})`,d={overallCompetitionRate:l.overallCompetitionRate};break}if(d){const w=[];v==="경쟁률"?w.push({label:"작년도 전체 경쟁률",value:`${(c=d.overallCompetitionRate)==null?void 0:c.toFixed(1)} : 1`||"N/A"}):(w.push({label:"모집 인원",value:`${Math.floor(Math.random()*30+20)}명`}),d.userCalculatedScore!==void 0&&w.push({label:"나의 예상 환산점수",value:`${d.userCalculatedScore.toFixed(2)}점`}),d.lastYearAvgConvertedScore!==void 0&&w.push({label:"최종등록자 평균 환산점수",value:`${d.lastYearAvgConvertedScore.toFixed(2)}점`}),d.lastYear70CutConvertedScore!==void 0&&w.push({label:"최종등록자 70%컷 환산점수",value:`${d.lastYear70CutConvertedScore.toFixed(2)}점`}),d.qualitativeEvaluation!==void 0&&w.push({label:"정성평가 결과 (예상)",value:d.qualitativeEvaluation}),d.suneungMinSatisfied!==void 0&&w.push({label:"수능최저 충족여부",value:d.suneungMinSatisfied?"충족":"미충족"})),p.push({sectionTitle:C,isHighlighted:!0,items:w,notes:["본 정보는 참고용입니다."]})}}v!=="교과"&&((m=l==null?void 0:l.admissionTypeResults)!=null&&m.gyogwa)&&p.push({sectionTitle:`학생부교과 전형 (${b})`,isHighlighted:!1,items:[{label:"작년 평균",value:((j=l.admissionTypeResults.gyogwa.lastYearAvgConvertedScore)==null?void 0:j.toFixed(2))||"N/A"}]}),v!=="종합"&&((h=l==null?void 0:l.admissionTypeResults)!=null&&h.jonghap)&&p.push({sectionTitle:`학생부종합 전형 (${b})`,isHighlighted:!1,items:[{label:"평가",value:l.admissionTypeResults.jonghap.qualitativeEvaluation||"N/A"}]}),p.push({sectionTitle:"관련 링크",isHighlighted:!1,items:[{label:"대학 입학처",value:`http://admission.${(g==null?void 0:g.universityId.toLowerCase().substring(0,3))||"example"}.ac.kr`,type:"link",link:`http://admission.${(g==null?void 0:g.universityId.toLowerCase().substring(0,3))||"example"}.ac.kr`},{label:"학과 홈페이지",value:`http://dept.${(g==null?void 0:g.universityId.toLowerCase().substring(0,3))||"example"}.ac.kr`,type:"link",link:`http://dept.${(g==null?void 0:g.universityId.toLowerCase().substring(0,3))||"example"}.ac.kr`}]}),o={universityName:y,departmentName:b,logoUrl:`https://via.placeholder.com/100?text=${u.substring(0,3)}`,sidebarSections:p}}else console.error(`Unknown API endpoint: ${a} ${t.pathname}`),o={error:`Unknown API endpoint: ${a} ${t.pathname}`}}catch(u){console.error("Error in mockFetch:",u),o={error:"Internal mockFetch error",details:u.message}}finally{O(!1)}return o}async function ue(e){try{return await Y(`${A}/subjects?type=${e}`)||[]}catch(n){return console.error(`Error fetching ${e} subjects:`,n),[]}}async function Wt(){At(await ue("naesin")),kt(await ue("suneung_국어")),Tt(await ue("suneung_수학")),Lt(await ue("suneung_탐구"))}async function Jt(e){if(!e){ce(null);return}const[n,a]=e.split("_"),t=n.substring(0,4),r=n.substring(4,6);if(!t||!r){console.error("Invalid examId format for fetching cut info:",e),ce(null);return}try{const s=await Y(`${A}/exam-grade-cuts?year=${t}&month=${r}`);ce(s)}catch(s){console.error("Error fetching Suneung exam cut info:",s),ce(null)}}let k=null,de=null,we=null;function Vt(e,n,a){k=e,de=n,we=a,we&&we.addEventListener("click",vt)}async function ht(e,n){if(k){at(e),O(!0);try{const a=`${A}/universities/${e}/sidebar-details?departmentName=${encodeURIComponent(n)}&admissionTypeFilter=${se}`,t=await Y(a,{method:"GET"});t&&t.error?(console.error("Error fetching sidebar details:",t.error,t.details),alert(`대학 상세 정보를 불러오는 데 실패했습니다: ${t.error}`),W(null)):t?(W(t),yt(),k.classList.remove("hidden"),k.classList.add("visible"),k.setAttribute("aria-hidden","false")):(alert("대학 상세 정보를 불러오지 못했습니다 (데이터 없음)."),W(null))}catch(a){console.error("Exception fetching sidebar details:",a),alert("대학 상세 정보를 불러오는 중 예외가 발생했습니다."),W(null)}finally{O(!1)}}}function vt(){k&&(k.classList.remove("visible"),k.classList.add("hidden"),k.setAttribute("aria-hidden","true"),W(null),at(null))}function yt(){if(!de)return;if(!x){de.innerHTML="<p>표시할 정보가 없습니다.</p>";return}let e=`
        <h3 id="sidebar-title">${x.universityName} - ${x.departmentName}</h3>
        ${x.logoUrl?`<img src="${x.logoUrl}" alt="${x.universityName} 로고" style="max-width:100px; margin: 0 auto 15px; display: block;">`:""}
    `;[...x.sidebarSections].sort((a,t)=>a.isHighlighted&&!t.isHighlighted?-1:!a.isHighlighted&&t.isHighlighted?1:0).forEach(a=>{const t=`section-title-${a.sectionTitle.replace(/\s+/g,"-").toLowerCase()}`;e+=`<div class="sidebar-section ${a.isHighlighted?"highlighted":""}" role="region" aria-labelledby="${t}">
                    <h4 id="${t}">${a.sectionTitle}</h4>`,a.items.forEach(r=>{let s=String(r.value);const o=r.link||(r.type==="link"?String(r.value):void 0);if(o){const i=r.type==="link"&&(r.label==="대학 입학처"||r.label==="학과 홈페이지")?"바로가기":r.value;s=`<a href="${o}" target="_blank" rel="noopener noreferrer">${i} <span class="external-link-indicator" aria-label="(새 창 열림)">↗</span></a>`}e+=`<div class="item">
                        <span class="label">${r.label}:</span>
                        <span class="value">${s}</span>
                    </div>`}),a.notes&&a.notes.length>0&&(e+='<ul class="notes">',a.notes.forEach(r=>{e+=`<li>${r}</li>`}),e+="</ul>"),e+="</div>"}),de.innerHTML=e}function Zt(e){if(e&&!D){const n=L.map(e).setView([36.5,127.5],7);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(n);const a=L.layerGroup().addTo(n);Et(a),Ct(n)}}async function Qt(){if(!(!D||!B)){O(!0);try{const e=await Y("/map/initial-data");if(B.clearLayers(),!e||e.length===0){console.warn("No initial university data received.");return}if(e.forEach(n=>{const a=jt(tt),t=L.divIcon({html:a,className:"custom-marker-icon",iconSize:[30,40],iconAnchor:[15,40],popupAnchor:[0,-40]}),r=L.marker([n.location.latitude,n.location.longitude],{icon:t}).bindTooltip(n.universityName);r.on("click",()=>{alert(wt)}),B.addLayer(r)}),e.length>0){const n=L.latLngBounds(e.map(a=>[a.location.latitude,a.location.longitude]));D.fitBounds(n,{padding:[50,50]})}}catch(e){console.error("Error loading initial markers:",e),alert("초기 대학 마커를 불러오는 데 실패했습니다.")}finally{O(!1)}}}function jt(e){return`<svg width="30" height="40" viewBox="0 0 30 40" xmlns="http://www.w3.org/2000/svg"><path d="M15,40 L0,12 Q15,-4 30,12 Z" fill="${e}" stroke="#FFF" stroke-width="1.5"/></svg>`}const Xt={수능:"suneung",교과:"gyogwa",종합:"jonghap"};function en(e,n){let a,t,r,s=tt,o=`${e.universityName}<br>${e.departmentName}`;if(n==="경쟁률"&&e.overallCompetitionRate!==void 0){const i=e.overallCompetitionRate,c=1,m=30,j={r:255,g:255,b:255},h={r:102,g:51,b:153},u=Math.min(1,Math.max(0,(i-c)/(m-c)));a=Math.round(j.r*(1-u)+h.r*u),t=Math.round(j.g*(1-u)+h.g*u),r=Math.round(j.b*(1-u)+h.b*u),s=`rgb(${a}, ${t}, ${r})`,o+=`<br>전체 경쟁률: ${i.toFixed(1)} : 1`}else if(n!=="경쟁률"){const i=Xt[n],c=i?e.admissionTypeResults[i]:void 0;if(c&&c.userCalculatedScore!==void 0&&c.lastYearAvgConvertedScore!==void 0){const m=c.userCalculatedScore,j=c.lastYearAvgConvertedScore,h=m-j,u=20,b=-20,v={r:76,g:175,b:80},l={r:3,g:169,b:244},g={r:255,g:193,b:7},y={r:211,g:47,b:47};if(h>=u)({r:a,g:t,b:r}=v);else if(h>0){const p=h/u;a=Math.round(l.r*(1-p)+v.r*p),t=Math.round(l.g*(1-p)+v.g*p),r=Math.round(l.b*(1-p)+v.b*p)}else if(h>b){const p=(h-b)/Math.abs(b);a=Math.round(g.r*(1-p)+l.r*p),t=Math.round(g.g*(1-p)+l.g*p),r=Math.round(g.b*(1-p)+l.b*p)}else({r:a,g:t,b:r}=y);s=`rgb(${a}, ${t}, ${r})`,o+=`<br>${n} 전형: 나의 ${m.toFixed(1)} / 작년 ${j.toFixed(1)} (차: ${h.toFixed(1)})`,c.suneungMinSatisfied!==void 0&&n!=="수능"&&(o+=`<br>수능최저: ${c.suneungMinSatisfied?"충족":"미충족"}`)}else n==="종합"&&(c!=null&&c.qualitativeEvaluation)?(s="rgb(150, 150, 150)",o+=`<br>${n} 전형: ${c.qualitativeEvaluation}`,c.suneungMinSatisfied!==void 0&&(o+=`<br>수능최저: ${c.suneungMinSatisfied?"충족":"미충족"}`)):o+=`<br>${n} 전형: 정보 없음`}return{color:s,tooltipText:o}}function ge(){if(!(!D||!B)){if(B.clearLayers(),F.length===0){me&&console.log("No universities match current filters.");return}if(F.forEach(e=>{if(!e.location||typeof e.location.latitude!="number"||typeof e.location.longitude!="number"){console.warn(`University ${e.universityName} has invalid location data. Skipping marker.`);return}const{color:n,tooltipText:a}=en(e,se),t=jt(n),r=L.divIcon({html:t,className:"custom-marker-icon",iconSize:[30,40],iconAnchor:[15,40],popupAnchor:[0,-40]}),s=L.marker([e.location.latitude,e.location.longitude],{icon:r}).bindTooltip(a,{direction:"top",offset:L.point(0,-40)});s.on("click",()=>{ht(e.universityId,e.departmentName)}),B.addLayer(s)}),F.length>0){const e=F.filter(n=>n.location&&typeof n.location.latitude=="number");if(e.length>0){const n=L.latLngBounds(e.map(a=>[a.location.latitude,a.location.longitude]));D.fitBounds(n,{padding:[50,50],maxZoom:15})}else D.setView([36.5,127.5],7)}else D.setView([36.5,127.5],7)}}const tn=document.getElementById("department-search"),nn=document.getElementById("department-suggestions"),an=document.getElementById("enter-grades-button"),Ge=document.getElementById("admission-type-filter"),Ce=document.getElementById("score-difference-tolerance"),Ee=document.getElementById("score-difference-tolerance-slider"),rn=document.getElementById("apply-filters-button"),Ke=document.getElementById("map"),He=document.getElementById("sidebar"),sn=document.getElementById("sidebar-content"),on=document.getElementById("close-sidebar-button"),cn=document.getElementById("loading-overlay"),he=document.getElementById("grade-input-modal"),un=document.getElementById("close-grade-modal-button"),ln=document.getElementById("save-grades-button"),Ue=document.getElementById("load-grades-input"),dn=document.getElementById("load-grades-button"),_e=he.querySelectorAll(".tab-button"),gn=he.querySelectorAll(".tab-content"),mn=document.getElementById("submit-grades-button"),pn=document.getElementById("naesin-subject-row-template"),bn={y1s1:document.getElementById("naesin-y1s1-subjects"),y1s2:document.getElementById("naesin-y1s2-subjects"),y2s1:document.getElementById("naesin-y2s1-subjects"),y2s2:document.getElementById("naesin-y2s2-subjects"),y3s1:document.getElementById("naesin-y3s1-subjects"),y3s2:document.getElementById("naesin-y3s2-subjects")},Pe=document.getElementById("suneung-exam-selector"),qe=document.getElementById("suneung-korean-choice"),Ye=document.getElementById("suneung-korean-raw"),fn=document.getElementById("suneung-korean-calculated"),ze=document.getElementById("suneung-math-choice"),We=document.getElementById("suneung-math-raw"),Sn=document.getElementById("suneung-math-calculated"),Je=document.getElementById("suneung-english-raw"),hn=document.getElementById("suneung-english-calculated"),Ve=document.getElementById("suneung-history-raw"),vn=document.getElementById("suneung-history-calculated"),Ze=document.getElementById("suneung-explorer1-subject"),Qe=document.getElementById("suneung-explorer1-raw"),yn=document.getElementById("suneung-explorer1-calculated"),Xe=document.getElementById("suneung-explorer2-subject"),et=document.getElementById("suneung-explorer2-raw"),jn=document.getElementById("suneung-explorer2-calculated");function wn(e){const n={};for(const a of[1,2,3])for(const t of[1,2]){if(a===3&&t===2)continue;const r=`year${a}`,s=`semester${t}`,o=e[r][s].subjects;if(o.length>0){const i=`${a}-${t}`;n[i]=o.map(c=>({id:c.id,subjectCode:c.subjectCode||"N/A",subjectName:c.subjectName,grade:c.grade,credits:c.credits,rawScore:c.rawScore,subjectMean:c.subjectMean,stdDev:c.stdDev}))}}return n}async function Cn(){if(!me){alert("학과를 먼저 선택해주세요."),ie([]),ge();return}_(),O(!0);try{const e=wn(M.naesin),n=M.suneung,a={userGrades:{naesin:e,suneung:n},filterCriteria:{departmentKeywords:me,admissionType:se,scoreDifferenceTolerance:V}};console.log("Sending to /universities/filter:",JSON.stringify(a,null,2));const t=await Y(`${A}/universities/filter`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});t&&Array.isArray(t)?ie(t):(console.error("Invalid response from /universities/filter:",t),ie([])),ge(),Q&&!F.find(r=>r.universityId===Q)&&vt()}catch(e){console.error("Error fetching filtered universities:",e),alert("대학 정보를 필터링하는 중 오류가 발생했습니다."),ie([]),ge()}finally{O(!1)}}document.addEventListener("DOMContentLoaded",async()=>{Dt({loadingOverlay:cn,departmentSearchInput:tn,departmentSuggestionsDiv:nn}),Vt(He,sn,on),Gt({gradeInputModal:he,modalTabsElements:_e,modalTabContentsElements:gn,naesinSubjectRowTemplate:pn,naesinGradeFormDivs:bn,suneungExamSelector:Pe,suneungKoreanChoice:qe,suneungKoreanRaw:Ye,suneungKoreanCalculatedDiv:fn,suneungMathChoice:ze,suneungMathRaw:We,suneungMathCalculatedDiv:Sn,suneungEnglishRaw:Je,suneungEnglishCalculatedDiv:hn,suneungHistoryRaw:Ve,suneungHistoryCalculatedDiv:vn,suneungExplorer1Subject:Ze,suneungExplorer1Raw:Qe,suneungExplorer1CalculatedDiv:yn,suneungExplorer2Subject:Xe,suneungExplorer2Raw:et,suneungExplorer2CalculatedDiv:jn}),Ke?Zt(Ke):console.error("Map container not found!"),await Qt(),await Wt(),await $e(),pt(),Ce.value=V.toString(),Ee.value=V.toString(),Ge.value=se,an.addEventListener("click",Kt),Ge.addEventListener("change",e=>{Mt(e.target.value),He.classList.contains("visible")&&x&&Q?ht(Q,x.departmentName):x&&yt(),F.length>0&&ge()}),Ce.addEventListener("change",e=>{const n=parseFloat(e.target.value);!isNaN(n)&&n>=0&&n<=100?(De(n),Ee.value=n.toString()):(e.target.value=V.toString(),alert("유효한 점수차 허용치를 입력해주세요 (0 ~ 100)."))}),Ee.addEventListener("input",e=>{const n=parseFloat(e.target.value);De(n),Ce.value=n.toFixed(0)}),rn.addEventListener("click",Cn),un.addEventListener("click",Re),mn.addEventListener("click",()=>{_(),Re(),alert("성적이 반영되었습니다. '필터 적용 및 지도 업데이트' 버튼을 클릭하여 결과를 확인하세요.")}),ln.addEventListener("click",Pt),dn.addEventListener("click",()=>Ue.click()),Ue.addEventListener("change",qt),_e.forEach(e=>e.addEventListener("click",Ht)),he.querySelectorAll(".add-subject-button").forEach(e=>{e.addEventListener("click",n=>{const a=n.target,t=parseInt(a.dataset.year),r=parseInt(a.dataset.semester);t&&r&&Ut(t,r)})}),Pe.addEventListener("change",$e),[Ye,We,Je,Ve,Qe,et,qe,ze,Ze,Xe].forEach(e=>{e&&(e.addEventListener("change",()=>{_()}),e.addEventListener("input",()=>{e.type==="number"&&_()}))}),console.log("Application initialized successfully with new API structure.")});
